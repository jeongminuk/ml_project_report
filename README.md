# 21101226 정민욱 ml_project_report

# 📈 무역 품목 간 공행성 쌍 판별 및 후행 품목 무역량 예측 AI 모델

## 1. 프로젝트 개요 (Project Overview)

### 1.1. 배경 및 목적
글로벌 무역 시장에서는 특정 품목의 수입 변동이 시간차를 두고 연관된 다른 품목의 무역량에 영향을 미치는 **공행성(Co-movement)** 현상이 빈번하게 발생합니다. 본 프로젝트는 2022년 1월부터 2025년 7월까지의 원시 무역 수입 데이터를 기반으로 품목 간의 **선후행 관계(Lead-Lag Relationship)**를 규명하고, 이를 활용하여 후행 품목(Follower)의 2025년 8월 총 무역량(Value)을 정밀하게 예측하는 AI 모델을 개발하는 것을 목표로 합니다.

참가자는 단순한 단일 시계열 예측을 넘어, 방대한 무역 데이터 속에서 유의미한 **공행성 쌍(A → B)**을 발굴해내야 하며, 선행 품목(A)의 변동 패턴을 선행지표로 활용하여 후행 품목(B)의 미래 수요를 예측하는 복합적인 추론 모델을 구축해야 합니다.

---

## 2. 데이터셋 정보 (Dataset Info)

본 프로젝트는 순환성(Cyclical)과 계절성, 그리고 품목 간 상호연관성을 가진 시계열 데이터를 다룹니다.

### `train.csv` (학습 데이터)
* **item_id**: 무역품의 고유 식별 ID
* **year / month**: 해당 무역 거래가 발생한 연도 및 월
* **hs4**: 품목의 HS4 분류 코드
* **value**: **[Target]** 해당 월의 총 무역량 (정수형)
* **weight / quantity**: 무역 중량 및 수량
* **type / seq**: 유형 구분 코드 및 일련번호

### `sample_submission.csv` (제출 양식)
* **leading_item_id**: 예측 모델이 판별한 선행 품목 ID
* **following_item_id**: 예측 모델이 판별한 후행 품목 ID
* **value**: 선행 품목의 정보를 바탕으로 예측한 2025년 8월 후행 품목의 무역량

---

## 3. 모델링 및 기술적 의사결정 (Technical Architecture & Decision Making)

본 프로젝트에서는 단순한 알고리즘 적용을 지양하고, 데이터의 특성과 시계열 예측의 본질적인 문제점을 해결하기 위해 다음과 같은 심도 있는 기술적 검토 과정을 거쳤습니다.

### 3.1. 선형 회귀의 한계와 비선형 모델링 검토

선형 모델(Linear Model)과 최적화 기법에 대한 고찰
시계열 예측의 베이스라인으로 선형 회귀를 검토하며, 모델 파라미터($\theta$)를 구하는 최적화 방법에 대해 심도 있게 고민하였습니다.

* **해석적 방법 (Normal Equation / SVD):** $\theta = (X^T X)^{-1} X^T y$ 와 같이 행렬 연산을 통해 한 번에 해를 구하는 방식은 데이터 수가 적을 때는 유효하나, 본 프로젝트와 같이 Feature가 많고 데이터가 방대한 경우 역행렬 계산 비용($O(n^3)$)이 과도하게 발생하여 부적합하다고 판단했습니다.
* **경사하강법 (Gradient Descent):** 따라서 손실 함수의 기울기를 따라 점진적으로 최적해를 찾아가는 Gradient Descent 방식을 채택했습니다.
    * **Batch GD:** 전체 데이터를 한 번에 학습하므로 안정적이나 메모리 부하가 큼.
    * **Stochastic GD:** 샘플 하나씩 학습하여 빠르지만 진동(Noise)이 심함.
    * **Mini-batch GD:** 위 두 방식의 절충안으로, 딥러닝 등에서 표준으로 사용됨.

초기 단계에서는 시계열 기반 수요 예측의 표준적인 접근법인 **선형 회귀(Linear Regression)**를 기본 예측기로 채택하였습니다. 그러나 무역 데이터에 내재된 복잡한 비선형 관계를 포착하기 위해 Feature 간의 곱이나 제곱항을 포함하는 **다항 회귀(Polynomial Regression)**의 적용 가능성을 면밀히 검토하였습니다.

검토 결과, Polynomial Regression은 Feature Space를 확장하여 비선형성을 학습할 수 있다는 장점이 있으나, 시계열 데이터 특유의 구조적 변화와 비정상성(Non-stationarity)으로 인해 미래 시점에 대한 **외삽(Extrapolation)** 능력이 현저히 떨어진다는 한계를 확인하였습니다. 특히, 본 연구에서는 이미 시차(Lag), 이동 평균(Rolling Statistics), 추세(Trend), 계절성(Seasonality) 등의 시계열 특성을 반영한 Feature Engineering이 선행되어 있었기에, 추가적인 다항 확장은 정보 획득량 대비 **다중공선성(Multicollinearity)**과 **과적합(Overfitting)**의 위험을 증대시킬 가능성이 크다고 판단하였습니다.

이에 따라 전체 Feature를 무차별적으로 다항 확장하는 접근을 배제하고, 공행성 분류를 통해 선별된 품목 쌍의 관계를 기반으로 핵심적인 상호작용만을 반영하거나, 비선형성과 변수 간 상호작용을 자동으로 학습할 수 있는 **트리 기반 회귀 모델(Tree-based Regression Model)**을 최종적인 대안으로 선정하여 시계열 예측의 안정성과 일반화 성능을 동시에 확보하였습니다.

### 3.2. 최적화 기법 선정: Mini-batch GD vs. XGBoost
모델의 학습 메커니즘을 선정함에 있어, 딥러닝에서 주로 활용되는 **미니 배치 경사하강법(Mini-batch Gradient Descent)**과 트리 기반 앙상블인 **XGBoost**의 대조 검토를 수행하였습니다.

첫째, 최적화 메커니즘의 관점에서 분석한 결과, Feature 간 이질성이 뚜렷한 정형(Tabular) 데이터셋에서는 1차 미분(Gradient)에만 의존하며 확률적 노이즈(Stochastic Noise)를 수반하는 미니 배치 방식보다, **테일러 급수 2차 항(Hessian)**을 활용하여 손실 함수를 정교하게 근사하고 전체 데이터의 전역적 최적 분기점을 탐색하는 XGBoost 방식이 수렴 안정성과 예측 정확도 측면에서 월등히 유리함을 이론적으로 확인하였습니다.

둘째, 학습의 구조적 접근 방식에 있어서도 본질적인 차이를 고려하였습니다. 미니 배치 기반의 학습이 사전에 정의된 모델 구조 내에서 가중치 파라미터(Weight Parameter)를 점진적으로 수정(Iterative Update)하며 최적해를 찾아가는 방식이라면, XGBoost는 기존 모델을 고정한 채 새로운 트리 함수를 순차적으로 결합하는 **가법 학습(Additive Training)** 방식을 채택하고 있습니다. 이는 단순히 파라미터 공간(Parameter Space)을 탐색하는 것을 넘어, **함수 공간(Function Space)**에서 이전 트리의 **오차(Residual)**를 보완하는 새로운 함수를 지속적으로 추가함으로써 모델의 표현력을 동적으로 확장하는 과정입니다.

이러한 방식은 복잡한 비선형 패턴과 불규칙한 변동성이 내재된 시계열 데이터의 잔차를 제어하는 데 있어, 고정된 선형 결합을 가정하는 방식보다 훨씬 유연하고 강력한 예측 성능을 발휘한다고 판단하였습니다. 이에 따라 불필요한 연산 비용을 최소화하고 최적의 일반화 성능을 확보하고자 최종적으로 XGBoost를 채택하여 연구를 진행했습니다.

---

## 4. 검증 전략 및 평가 지표 (Validation & Metrics)

### 4.1. 시계열 데이터에 특화된 교차 검증 (Cross-Validation)
일반적인 K-Fold 교차 검증은 데이터를 무작위로 섞어 학습하기 때문에, 미래의 정보가 과거의 학습에 영향을 미치는 **Look-ahead Bias(전방 참조 편향)**가 발생할 수 있습니다. 이는 인과관계가 핵심인 시계열 예측에서 치명적인 오류를 초래합니다.

이를 방지하기 위해 본 프로젝트에서는 **TimeSeriesSplit** 기법을 적용하였습니다. 이는 훈련 세트의 크기를 점진적으로 늘려가며 학습하되, 검증 세트는 항상 훈련 세트보다 미래의 시점을 갖도록 강제하는 방식입니다. 이를 통해 시간의 흐름을 엄격히 준수하면서도 모델의 시간적 일반화 성능을 객관적으로 평가할 수 있었습니다.

### 4.2. 선후행 관계의 진위 검증: Granger Causality Test
단순히 두 시계열의 상관계수(Correlation)가 높다는 사실만으로는 인과관계를 단정할 수 없습니다. 우연히 추세가 유사한 **가짜 상관(Spurious Correlation)**일 가능성을 배제하기 위해 통계적 검정 방법인 **그레인저 인과관계 검정(Granger Causality Test)**을 도입하였습니다.

이는 "선행 품목(Leader)의 과거 데이터가 후행 품목(Follower)의 현재 데이터를 예측하는 데 통계적으로 유의미한 정보(Predictive Power)를 제공하는가?"를 검증하는 과정입니다. 본 연구에서는 귀무가설($H_0$: 인과관계가 없다)에 대한 **p-value가 0.05 미만**인 경우에만 유의미한 공행성 쌍으로 인정하고 모델 학습에 활용함으로써, 예측의 논리적 타당성을 확보하였습니다.

### 4.3. 평가 지표의 재정립: MSE/R2의 한계와 대안
전통적인 회귀 평가지표인 MSE(Mean Squared Error)와 R2 Score는 본 데이터셋에서 다음과 같은 한계를 가집니다.

1.  **Scale 의존성:** 무역량은 품목에 따라 수십 단위에서 수만 단위까지 편차가 매우 큽니다. MSE는 값의 스케일이 큰 품목의 오차에 압도적으로 민감하게 반응하여, 물량은 적지만 중요한 품목의 예측 성능 저하를 감지하지 못할 위험이 있습니다.
2.  **데이터 희소성(Sparsity):** 무역 데이터에는 거래량이 '0'인 구간이 빈번하게 존재합니다. 모델이 단순히 모든 값을 0으로 예측하더라도 MSE나 R2 지표상으로는 우수한 성능으로 오인될 수 있는 함정이 존재합니다.

따라서 본 프로젝트에서는 절대적인 오차의 크기보다는 실제값 대비 오차의 비율을 중점적으로 고려하는 **WMAPE(Weighted Mean Absolute Percentage Error)** 등의 지표를 활용하여, 품목별 규모의 차이에 왜곡되지 않는 균형 잡힌 성능 평가를 수행하였습니다.